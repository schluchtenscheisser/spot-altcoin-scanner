# T1.1 – Global Ranking berechnen

**Quelle:** `docs/v2/30_IMPLEMENTATION_TICKETS.md` (Canonical, Stand: 2026-02-18)  
**Erstellt am:** 2026-02-19

## Ziel

Implementiere die Berechnung eines **Global Rankings (Top-20)** über alle gültigen SetupResults, zusätzlich zu den Setup-spezifischen Rankings.

## Kontext
Epic 1 ergänzt eine globale Sicht über alle Setups („Global Top-20“), ohne die bestehenden Setup-Tabs/Sheets zu verändern.

## Anforderungen (aus Canonical)
- Aggregation über alle **gültigen** SetupResults.
- `global_score = max(setup_score * setup_weight)` (Default Gewichte: 1.0 / 0.9 / 0.8).
- `best_setup_type`, `confluence`, Flags aggregieren.
- Stable sorting bei Ties (siehe Feature-Spec).

## Akzeptanzkriterien
- Global Ranking enthält ausschließlich Setups mit `is_valid_setup=True` (und später auch Hard-Excludes wie Liquidity Grade D / Denylist, sofern implementiert).
- Für jedes Symbol wird ein **global_score** berechnet und ein **best_setup_type** bestimmt.
- Sorting ist deterministisch (stabil bei Gleichständen).
- Unit-/Golden-Tests decken Tie-Fälle und Determinismus ab.

## Relevante Dateien / Einstiegspunkte (zu identifizieren)
- Output-/Aggregation-Layer, der SetupResults zusammenführt (z. B. Report/Exporter/Renderer).
- Datenmodelle für SetupResult + Ranking-Output.
- Feature-Spec / Ranking-Definitionen (Repo-Dokumente durchsuchen).

## Vorgehen
1. Finde die Stelle, an der Setup-Toplisten erzeugt werden.
2. Implementiere Global-Aggregation:
   - pro Symbol Kandidaten (SetupResults je SetupType)
   - Score-Gewichtung + max
   - Confluence-/Flag-Aggregation nach Feature-Spec
3. Implementiere deterministischen Sort-Key:
   - primary: global_score desc
   - tie-break gemäß Spec (z. B. confluence desc / symbol asc)
4. Tests:
   - deterministische Reihenfolge bei gleichen Scores
   - Filter auf nur gültige Setups

## PR-Checkliste
- Keine Breaking Changes an bestehenden Setup-Outputs.
- Tests grün.


## Abschluss- und Archiv-Schritt (Pflicht)
Nach Merge/Abschluss dieses Tickets:
1. Verschiebe **diese** Ticket-Datei nach `docs/legacy/tickets/` (gleicher Dateiname).
2. Falls du in `docs/v2/30_IMPLEMENTATION_TICKETS.md` einen Status-Abschnitt führst: Ticket dort als „done“ markieren (optional, nur wenn ihr das so nutzt).
